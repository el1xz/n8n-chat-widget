# Чат-виджет для сайта

Гибкий и легко настраиваемый чат-виджет, который можно встроить на любой веб-сайт для взаимодействия с пользователями через n8n и Telegram.

## Возможности

-   **Простая интеграция:** Достаточно добавить одну строку кода на ваш сайт.
-   **Связь с n8n:** Отправляет сообщения пользователя на указанный n8n webhook.
-   **Кнопка Telegram:** Позволяет пользователям быстро перейти в ваш Telegram-бот.
-   **Гибкая кастомизация:** Внешний вид виджета можно полностью изменить с помощью CSS-переменных или подключив собственный файл стилей.
-   **Адаптивный дизайн:** Корректно отображается на мобильных устройствах и десктопах.
-   **JavaScript API:** Управляйте виджетом (открыть, закрыть, отправить сообщение) с помощью простого API.
-   **Индикатор набора текста:** Пользователи видят, когда ассистент "печатает" ответ.

## Установка

1.  Разместите файлы `chat-widget.js` и `chat-widget.css` на вашем сервере или CDN.
2.  Добавьте следующий код перед закрывающим тегом `</body>` на вашей HTML-странице:

```html
<script src="ПУТЬ_К_ВАШЕМУ/chat-widget.js" 
        data-n8n-webhook-url="https://your-n8n-instance/webhook/chat"
        data-telegram-url="https://t.me/your_telegram_bot"
        defer>
</script>
```

### Обязательные атрибуты

-   `data-n8n-webhook-url`: URL вашего вебхука в n8n, который будет принимать сообщения от пользователя.
-   `data-telegram-url`: Полная ссылка на вашего Telegram-бота.

---

## Настройка стилей

Вы можете кастомизировать внешний вид виджета двумя способами.

### 1. Подключение своего CSS-файла

Добавьте атрибут `data-css-url` в тег скрипта, указав путь к вашему файлу стилей. Это заменит стандартный `chat-widget.css`.

```html
<script src="ПУТЬ_К_ВАШЕМУ/chat-widget.js" 
        data-css-url="ПУТЬ_К_ВАШЕМУ_КАСТОМНОМУ/styles.css"
        ...>
</script>
```

### 2. Переопределение CSS-переменных

Для быстрой и безопасной кастомизации используйте атрибут `data-custom-styles`. Передайте в него JSON-объект в одинарных кавычках, где ключи - это CSS-переменные, а значения - их новые цвета.

**Пример:**

```html
<script src="ПУТЬ_К_ВАШЕМУ/chat-widget.js"
        data-custom-styles='{
            "--chat-primary-color": "#ff6347",
            "--chat-primary-hover": "#e0553c",
            "--chat-bubble-user-bg": "#ff6347"
        }'
        ...>
</script>
```

**Доступные CSS-переменные для кастомизации:**

| Переменная                 | Описание                                  | Стандартное значение |
| -------------------------- | ----------------------------------------- | -------------------- |
| `--chat-primary-color`     | Основной цвет (кнопки, заголовок)         | `#007bff`            |
| `--chat-primary-hover`     | Основной цвет при наведении               | `#0056b3`            |
| `--chat-secondary-color`   | Второстепенный цвет                       | `#f0f4f8`            |
| `--chat-background-color`  | Фон виджета                               | `#ffffff`            |
| `--chat-text-color`        | Основной цвет текста                      | `#333333`            |
| `--chat-bubble-bot-bg`     | Фон сообщения от бота                     | `#e9e9eb`            |
| `--chat-bubble-user-bg`    | Фон сообщения от пользователя             | `var(--chat-primary-color)` |
| `--chat-bubble-user-text`  | Цвет текста в сообщении пользователя      | `#ffffff`            |
| `--chat-border-color`      | Цвет границ                               | `#e1e5e9`            |
| `--chat-shadow`            | Тень виджета                              | `0 5px 25px rgba(0,0,0,0.15)` |

---

## JavaScript API

Вы можете управлять виджетом с помощью глобального объекта `window.ChatWidget`.

```javascript
// Проверить, что виджет загружен
if (window.ChatWidget) {
    // Открыть чат
    window.ChatWidget.show();

    // Закрыть чат
    window.ChatWidget.hide();

    // Переключить состояние (открыт/закрыт)
    window.ChatWidget.toggle();
    
    // Проверить, открыт ли чат
    console.log('Чат открыт:', window.ChatWidget.isOpen()); // true или false

    // Добавить сообщение в чат от имени пользователя или бота
    // Синтаксис: addMessage(text, sender, isHTML)
    // sender может быть 'user' или 'bot'
    window.ChatWidget.addMessage('Привет! Это тестовое сообщение.', 'bot');
}
```

---

## Требования к n8n Webhook

Ваш вебхук должен быть настроен на метод `POST` и уметь обрабатывать и отправлять JSON.

**Входящий запрос (от виджета к n8n):**

Вебхук получит JSON следующего формата:

```json
{
  "message": "Сообщение от пользователя"
}
```

**Ответ (от n8n к виджету):**

Вебхук должен вернуть JSON со следующим ключом:

```json
{
  "reply": "Ответ от вашего ассистента"
}